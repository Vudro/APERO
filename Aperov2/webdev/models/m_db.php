<?php// MODELclass MainModel extends PDO{    private $arr_executed_sql = [];    function __construct()    {        parent::__construct('mysql:host=' . DB_HOST . ';port=3306;dbname=' . DB_NAME . ';charset=UTF8;', DB_LOGIN, DB_PASS);        $this->query('SET NAMES utf8;');    }    function execQuery($request)    {        $rest = $this->query($request)->fetchAll(PDO::FETCH_ASSOC);        $this->arr_executed_sql[] = $request;        return $rest;    }    function execInsert($request)    {        $rest = $this->exec($request);        $this->arr_executed_sql[] = $request;        return $rest;    }    function getLastQuery()    {        return end($this->arr_executed_sql);    }    function afficherEnfantFamille()    {        return $this->execQuery('SELECT Enfants.PrenomEnfant, Famille.NomFamille, Famille.AdresseFamille FROM Famille INNER JOIN Enfants ON Famille.IdFamille = Enfants.IdFamille;');    }    function afficherEnfant()    {        return $this->execQuery('SELECT * FROM enfant WHERE idfamille IS NULL;');    }    function afficherEtablissement()    {        return $this->execQuery('SELECT * FROM etablissement;');    }    function afficherLivreClasse()    {        return $this->execQuery('SELECT * FROM livre;');    }    function afficherMatiere()    {        return $this->execQuery('SELECT * FROM matiere;');    }    function afficherClasse()    {        return $this->execQuery('SELECT * FROM classe;');    }    function afficherLivre()    {        return $this->execQuery('SELECT * FROM livre;');    }    function exemplaireFamille()    {        return $this->execQuery('SELECT Famille.IdFamille, Famille.NomFamille, Livre.NomLivre, Exemplaire.EtatExemplaire, Livre.MatiÃ¨re, Livre.EditionLivre                                  FROM Livre RIGHT JOIN (Exemplaire RIGHT JOIN Famille ON Exemplaire.Id_Famille_Vendeur = Famille.IdFamille) ON Livre.IdLivre = Exemplaire.Id_Livre                                  WHERE (((Famille.IdFamille)=[Id_Famille_Vendeur]) AND ((Exemplaire.EtatExemplaire)="Non Vendu"));');    }    function exemplaireVente()    {        return $this->execQuery('SELECT * FROM exemplaire e INNER JOIN famille f ON e.idfamille=f.idfamille INNER JOIN livre l ON e.id_livre=l.id_livre WHERE exemplaireetat="Non Vendu";');    }    function exemplaireVendu()    {        return $this->execQuery('SELECT * FROM exemplaire e INNER JOIN famille f ON e.idfamille=f.idfamille INNER JOIN livre l ON e.id_livre=l.id_livre WHERE exemplaireetat="Vendu";');    }    function exemplaireAcheter()    {        return $this->execQuery('SELECT * FROM exemplaire e INNER JOIN famille f ON e.idfamille=f.idfamille INNER JOIN livre l ON e.id_livre=l.id_livre ;');    }    function afficherFamille()    {        return $this->execQuery('SELECT * FROM famille;');    }    function afficherExemplaire()    {        return $this->execQuery('SELECT * FROM exemplaire;');    }    function afficherEtat()    {        return $this->execQuery('SELECT * FROM etat;');    }    function familleVente()    {        return $this->execQuery('SELECT idfamille FROM exemplaire;');    }    function remboursement()    {        return $this->execQuery('SELECT prixneuf FROM livre L INNER JOIN exemplaire E ON L.id_livre=E.id_livre WHERE L.id_livre=1;');    }    function remboursement2()    {        return $this->execQuery('SELECT decote FROM etat INNER JOIN exemplaire E ON etat.nometat=E.nometat WHERE E.id_livre=1;');    }    function ajoutMatiere($matiere)    {        $matiere = $this->quote($matiere);        return $this->execInsert('INSERT INTO matiere(nommatiere) VALUES ('.$matiere.');');    }    function ajoutLivre($nomLivre, $editionLivre, $prixNeuf, $matiere)    {        $nomLivre = $this->quote($nomLivre);        $editionLivre = $this->quote($editionLivre);        $prixNeuf = $this->quote($prixNeuf);        $matiere = $this->quote($matiere);        return $this->execInsert('INSERT INTO livre(nommatiere, nomlivre, editionlivre, prixneuf) VALUES ('.$matiere.','.$nomLivre.', '.$editionLivre.', '.$prixNeuf.');');    }    function affecterLivre($nivClasse, $section, $etablissement, $nomlivre)    {        $nivClasse = $this->quote($nivClasse);        $section = $this->quote($section);        $etablissement = $this->quote($etablissement);        $nomlivre = $this->quote($nomlivre);        return $this->execInsert('UPDATE livre SET idc =(SELECT idc FROM classe                                   INNER JOIN etablissement ON classe.idetablissement=etablissement.idetablissement                                   WHERE niveauclasse='.$nivClasse.' AND section='.$section.' AND etablissement.nometablissement='.$etablissement.') WHERE nomlivre='.$nomlivre.';');    }    function ajoutEtablissement($etablissement)    {        $etablissement = $this->quote($etablissement);        return $this->execInsert('INSERT INTO etablissement(nometablissement) VALUES ('.$etablissement.');');    }    function ajoutFamille($nomFamille, $adresseFamille, $cpFamille, $telFamille, $mailFamille, $villeFamille)    {        $nomFamille = $this->quote($nomFamille);        $adresseFamille = $this->quote($adresseFamille);        $cpFamille = $this->quote($cpFamille);        $telFamille = $this->quote($telFamille);        $mailFamille = $this->quote($mailFamille);        $villeFamille = $this->quote($villeFamille);        return $this->execInsert('INSERT INTO famille(nomfamille, adressefamille, cpfamille, villefamille, telfamille, mailfamille) VALUES ('.$nomFamille.','.$adresseFamille.', '.$cpFamille.', '.$villeFamille.', '.$telFamille.', '.$mailFamille.');');    }    function afficherFamilleEnfant()    {        return $this->execQuery('SELECT * FROM famille INNER JOIN enfant ON famille.idfamille=enfant.idfamille ORDER BY nomfamille;');    }    function ajoutEnfant($nomEnfant, $prenomEnfant, $classe, $nivEnfant)    {        $nomEnfant = $this->quote($nomEnfant);        $prenomEnfant = $this->quote($prenomEnfant);        $classe = $this->quote($classe);        $nivEnfant = $this->quote($nivEnfant);        return $this->execInsert('INSERT INTO enfant(prenomenfant, classeenfant, nomenfant, niveauenfant) VALUES ('.$prenomEnfant.','.$classe.', '.$nomEnfant.', '.$nivEnfant.');');    }    function affecterEnfant($enfant, $famille)    {        $enfant = $this->quote($enfant);        $famille = $this->quote($famille);        return $this->execInsert('UPDATE enfant SET idfamille =(SELECT idfamille FROM famille WHERE nomfamille='.$famille.') WHERE nomenfant='.$enfant.';');    }    function ajoutClasse($classe, $section)    {        $classe = $this->quote($classe);        $section = $this->quote($section);        return $this->execInsert('INSERT INTO classe(niveauclasse, section) VALUES ('.$classe.', '.$section.');');    }    function afficherClasseAffecter()    {        return $this->execQuery('SELECT * FROM classe WHERE idetablissement IS NULL;');    }    function affecterClasse($etablissement, $classe, $section)    {        $etablissement = $this->quote($etablissement);        $classe = $this->quote($classe);        $section = $this->quote($section);        return $this->execInsert('UPDATE classe SET idetablissement =(SELECT idetablissement FROM etablissement WHERE nometablissement='.$etablissement.') WHERE niveauclasse='.$classe.' AND section='.$section.';');    }}